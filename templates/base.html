{% extends "bootstrap/base.html" %}
<!DOCTYPE html>
<html {% block html_attribs %}{% endblock html_attribs %}>
{% block html %}
    <head>
        {% block head %}
            <title>{% block title %}{% endblock title %}</title>

            {% block metas %}
                <meta charset="utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=edge">
                <meta name="viewport" content="width=device-width, initial-scale=1">
            {% endblock metas %}

            {% block styles %}
                <link href="{{ url_for('static', filename='css/bootstrap.css') }}" rel="stylesheet" media="screen">
                <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" media="screen">
            {% endblock %}
        {% endblock head %}
    </head>
    <body {% block body_attribs %}{% endblock body_attribs %}>
    {% block body %}
        {% block navbar %}

        {% endblock navbar %}
        {% block content %}
            <div class="container-fluid">
                <div class="row">
                    <nav class="navbar navbar-default navbar-inverse">
                        <div class="container-fluid">
                            <!-- Brand and toggle get grouped for better mobile display -->
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                        data-target="#bs-example-navbar-collapse-1">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <a class="navbar-brand" href="/"><img
                                        src="{{ url_for('static', filename='images/solle_top_logo.png') }}"/></a>
                            </div>

                            <!-- Collect the nav links, forms, and other content for toggling -->
                            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                <ul class="nav navbar-nav navbar-right">
                                    {% if loggedin %}
                                        <li><a href="/logout/">{{ _('Logout') }}</a></li>
                                    {% else %}
                                        <li><a href="/register/">{{ _('Create an Account') }}</a></li>
                                        <li><a href="/login/">{{ _('Login') }}</a></li>
                                    {% endif %}

                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                           aria-expanded="false">{{ config['LANGUAGES'][language] }} <span
                                                class="caret"></span></a>
                                        <ul class="dropdown-menu" role="menu">
                                            {% for lang in config['LANGUAGES'] %}
                                                <li>
                                                    <a href="/language/{{ lang }}/?next={{ request.path }}">{{ config['LANGUAGES'][lang] }}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                            <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container-fluid -->
                    </nav>
                </div>



                {% block header %}

                {% endblock %}

                {% block container %}
                    <div id="system-message" style="display: none;"></div>
                {% endblock %}
            </div>

        {% endblock content %}

        {% block scripts %}
            <script src="{{ url_for('static', filename='js/jquery.js') }}"></script>
            <script src="{{ url_for('static', filename='js/jquery.cookie.js') }}"></script>
            <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
            <script src="{{ url_for('static', filename='js/jquery.isotope.js') }}"></script>


            <script>
                {#        var api_endpoint = "http://catchmycommission.com";#}
                var api_endpoint = "http://127.0.0.1:8111";
                function valid_token() {
                    var token = $.cookie("token");
                    if (typeof token !== 'undefined') {
                        if (token.length == 40) {
                            return true;
                        }
                    }
                    $.removeCookie("token", {path: '/'});
                    return false
                }

                $.fn.serializeObject = function () {
                    var o = {};
                    var a = this.serializeArray();
                    $.each(a, function () {
                        if (o[this.name] !== undefined) {
                            if (!o[this.name].push) {
                                o[this.name] = [o[this.name]];
                            }
                            o[this.name].push(this.value || '');
                        } else {
                            o[this.name] = this.value || '';
                        }
                    });
                    return o;
                };

                $(document).ready(function ($) {
                    {% if redirected %}
                        $.removeCookie("token", {path: '/'});
                        window.location = "{{ redirect }}";
                    {% endif %}
                    {% block document_ready %}
                        if (window.location.pathname != "/" && window.location.pathname != "/login/" &&
                                window.location.pathname != "/register/" && window.location.pathname != "/products/") {
                            var token = $.cookie("token");
                            if (!valid_token()) {
                                window.location = '/login/?next=' + window.location.pathname;
                            }
                            console.log(token);
                        }
                    {% endblock %}
                });

            </script>
        {% endblock scripts %}
    {% endblock body %}
    </body>

{% endblock html %}
</html>


